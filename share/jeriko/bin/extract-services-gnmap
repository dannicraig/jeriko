#!/bin/sh
#description: extracts services from gnmap files provided as standard input

grep -E '^Host:' | while read LINE
do
	HOST=`echo $LINE | sed. -e 's/Host: ([^ ]*).*/\1/'`

	echo $LINE | sed. -e 's/.*Ports: //' -e 's/, /\n/g' | grep '/open/' | sed. -e 's/\/open\//\//' | awk -F'/' '{ print $1","$2","$4 }' | while read PORT
	do
		PORT=`echo $PORT | cut -d'?' -f1 | sed. -e 's/\|/-/g' -e 's/\?$//'`
		echo $HOST,$PORT
	done
done | sort | uniq
