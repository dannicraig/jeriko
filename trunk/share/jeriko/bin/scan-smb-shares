#!/bin/sh

if [ ! "$SMBCLIENT_CONNECT_METHOD" ]
then
	SMBCLIENT_CONNECT_METHOD="-N"
fi

TIMESTAMP=`date +%s`

ARGS=$@
if [ "$ARGS" ]
then
	for LINE in $ARGS
	do
		echo $LINE
	done
else
	cat
fi | sort | uniq | while read IP
do
	echo "[*] scanning $IP/$SHARE"
	smbclient -L $IP -I $IP $SMBCLIENT_CONNECT_METHOD | tee smb_scan_${IP}_${TIMESTAMP}.session
done
